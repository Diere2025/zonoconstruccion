<!DOCTYPE html>
<html lang="es" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo de Productos por Categoría - Zono Construcción y Hogar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="styles.css">
    <style>
        html { scroll-padding-top: 6rem; }
        .sidebar-link-active { color: #2563eb; font-weight: 600; border-left: 3px solid #2563eb; padding-left: 0.5rem; margin-left: -0.75rem; background-color: #eff6ff; }
        html.dark .sidebar-link-active { color: #60a5fa; border-left-color: #60a5fa; background-color: #1f2937; }
        .loading-message { text-align: center; padding: 2rem; color: #6b7280; }
        html.dark .loading-message { color: #9ca3af; }
    </style>
     <script>
        (function() {
            try {
                const currentTheme = localStorage.getItem('theme');
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                if (currentTheme === 'dark' || (!currentTheme && prefersDark)) {
                    document.documentElement.classList.add('dark');
                    document.documentElement.classList.remove('light');
                } else {
                    document.documentElement.classList.add('light');
                    document.documentElement.classList.remove('dark');
                }
            } catch (e) { console.error("Error applying initial theme:", e); document.documentElement.classList.add('light'); document.documentElement.classList.remove('dark'); }
        })();
    </script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-300">

    <header class="bg-white dark:bg-gray-800 shadow-md sticky top-0 z-50 transition-colors duration-300">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="index.html#inicio" class="flex items-center">
                <img src="images/logo-zono.png" alt="Logo Zono Construcción y Hogar" class="h-12 md:h-16 mr-2">
            </a>
            <div class="hidden md:flex space-x-6 items-center">
                <a href="index.html#inicio" class="text-gray-600 dark:text-gray-300 hover:text-blue-500 dark:hover:text-blue-400 transition duration-300">Inicio</a>
                <a href="catalogo.html" class="nav-link-active hover:text-blue-500 dark:hover:text-blue-400 transition duration-300">Catálogo</a>
                <a href="categorias.html" class="text-gray-600 dark:text-gray-300 hover:text-blue-500 dark:hover:text-blue-400 transition duration-300">Categorías</a>
                <a href="index.html#destacados" class="text-gray-600 dark:text-gray-300 hover:text-blue-500 dark:hover:text-blue-400 transition duration-300">Destacados</a>
                <a href="index.html#nosotros" class="text-gray-600 dark:text-gray-300 hover:text-blue-500 dark:hover:text-blue-400 transition duration-300">Nosotros</a>
                <a href="index.html#contacto" class="text-gray-600 dark:text-gray-300 hover:text-blue-500 dark:hover:text-blue-400 transition duration-300">Contacto</a>
                <a id="header-whatsapp-link" href="#" target="_blank" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded-full text-sm font-medium flex items-center space-x-1 transition duration-300">
                    <i class="fab fa-whatsapp"></i>
                    <span>WhatsApp</span>
                </a>
                </div>
            <button class="md:hidden flex items-center px-3 py-2 border rounded text-gray-500 dark:text-gray-400 border-gray-600 dark:border-gray-500 hover:text-blue-500 dark:hover:text-blue-400 hover:border-blue-500 dark:hover:border-blue-400">
                <svg class="fill-current h-3 w-3" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Menu</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v15z"/></svg>
            </button>
        </nav>
    </header>

    <div class="container mx-auto px-6 flex flex-col md:flex-row gap-8 py-12 md:py-16">

        <aside class="w-full md:w-1/4 lg:w-1/5 md:sticky md:top-24 md:self-start bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md mb-8 md:mb-0 hidden md:block transition-colors duration-300" style="max-height: calc(100vh - 7rem);">
            <h3 class="text-lg font-semibold mb-4 text-blue-700 dark:text-blue-400 border-b border-gray-300 dark:border-gray-600 pb-2">Categorías</h3>
            <nav>
                <ul class="space-y-2">
                    <li><a href="#cat-tanques" class="block py-1 px-2 text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-gray-700 rounded transition duration-200 sidebar-link">Tanques de Agua</a></li>
                    <li><a href="#cat-hogar" class="block py-1 px-2 text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-gray-700 rounded transition duration-200 sidebar-link">Hogar y Climatización</a></li>
                    <li><a href="#cat-ferreteria" class="block py-1 px-2 text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-gray-700 rounded transition duration-200 sidebar-link">Ferretería y Herramientas</a></li>
                    <li><a href="#cat-pinturas" class="block py-1 px-2 text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-gray-700 rounded transition duration-200 sidebar-link">Pinturas y Revestimientos</a></li>
                    <li><a href="#cat-impermeabilizantes" class="block py-1 px-2 text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-gray-700 rounded transition duration-200 sidebar-link">Impermeabilizantes</a></li>
                    <li><a href="#cat-construccion" class="block py-1 px-2 text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-gray-700 rounded transition duration-200 sidebar-link">Materiales de Construcción</a></li>
                </ul>
            </nav>
        </aside>

        <main class="w-full md:w-3/4 lg:w-4/5">
            <h1 class="text-3xl md:text-4xl font-bold text-center mb-10 md:mb-12 text-blue-700 dark:text-blue-400">Catálogo de Productos</h1>

            <section id="cat-tanques" class="category-section mb-16 scroll-mt-24">
                <h2 class="text-2xl font-semibold border-b-2 border-blue-300 dark:border-blue-600 pb-2 mb-8 text-blue-700 dark:text-blue-400">Tanques de Agua</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 product-grid-container">
                    <p class="loading-message col-span-full">Cargando productos...</p>
                </div>
            </section>

            <section id="cat-hogar" class="category-section mb-16 scroll-mt-24">
                <h2 class="text-2xl font-semibold border-b-2 border-blue-300 dark:border-blue-600 pb-2 mb-8 text-blue-700 dark:text-blue-400">Hogar y Climatización</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 product-grid-container">
                    <p class="loading-message col-span-full">Cargando productos...</p>
                </div>
            </section>

            <section id="cat-ferreteria" class="category-section mb-16 scroll-mt-24">
                <h2 class="text-2xl font-semibold border-b-2 border-blue-300 dark:border-blue-600 pb-2 mb-8 text-blue-700 dark:text-blue-400">Ferretería y Herramientas</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 product-grid-container">
                    <p class="loading-message col-span-full">Cargando productos...</p>
                </div>
            </section>

            <section id="cat-pinturas" class="category-section mb-16 scroll-mt-24">
                 <h2 class="text-2xl font-semibold border-b-2 border-blue-300 dark:border-blue-600 pb-2 mb-8 text-blue-700 dark:text-blue-400">Pinturas y Revestimientos</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 product-grid-container">
                    <p class="loading-message col-span-full">Cargando productos...</p>
                </div>
            </section>

            <section id="cat-impermeabilizantes" class="category-section mb-16 scroll-mt-24">
                 <h2 class="text-2xl font-semibold border-b-2 border-blue-300 dark:border-blue-600 pb-2 mb-8 text-blue-700 dark:text-blue-400">Impermeabilizantes</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 product-grid-container">
                     <p class="loading-message col-span-full">Cargando productos...</p>
                </div>
            </section>
            <section id="cat-construccion" class="category-section mb-16 scroll-mt-24">
                 <h2 class="text-2xl font-semibold border-b-2 border-blue-300 dark:border-blue-600 pb-2 mb-8 text-blue-700 dark:text-blue-400">Materiales de Construcción</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 product-grid-container">
                     <p class="loading-message col-span-full">Cargando productos...</p>
                </div>
            </section>

        </main> </div> <a id="whatsapp-float-button" href="#" class="whatsapp-float" target="_blank" aria-label="Contactar por WhatsApp"><i class="fab fa-whatsapp"></i></a>

    <footer class="bg-gray-800 dark:bg-black text-gray-300 dark:text-gray-400 py-8 transition-colors duration-300">
        <div class="container mx-auto px-6 text-center">
            <p>© <span id="year"></span> Zono Construcción y Hogar. Todos los derechos reservados.</p>
            <p class="text-sm mt-2">Remedios de Escalada 4747, Villa Luzuriaga</p>
            <div class="mt-4 text-sm">
                <a href="index.html#inicio" class="hover:text-blue-400 transition duration-300 px-2">Inicio</a>|
                <a href="catalogo.html" class="hover:text-blue-400 transition duration-300 px-2">Catálogo</a>|
                <a href="categorias.html" class="hover:text-blue-400 transition duration-300 px-2">Categorías</a>|
                <a href="index.html#contacto" class="hover:text-blue-400 transition duration-300 px-2">Contacto</a>
            </div>
            <div class="mt-4">
                 <a id="footer-email-link" href="#" class="text-sm text-blue-400 hover:text-blue-300 transition duration-300 mx-2"><i class="fas fa-envelope mr-1"></i> <span id="footer-email-address"></span></a>
            </div>
            <div class="mt-3 flex justify-center space-x-4">
                 <a id="footer-facebook-link" href="#" target="_blank" class="text-gray-400 hover:text-blue-400 transition duration-300" title="Facebook"><i class="fab fa-facebook-f text-xl"></i></a>
                 <a id="footer-instagram-link" href="#" target="_blank" class="text-gray-400 hover:text-pink-400 transition duration-300" title="Instagram"><i class="fab fa-instagram text-xl"></i></a>
            </div>
        </div>
    </footer>

    <script src="config.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Theme Initializer ---
            const htmlElement = document.documentElement;
            const applyTheme = (theme) => { if (theme === 'dark') { htmlElement.classList.remove('light'); htmlElement.classList.add('dark'); } else { htmlElement.classList.remove('dark'); htmlElement.classList.add('light'); } };
            applyTheme(localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'));
            // --- End Theme Initializer ---

            // --- Config Data Logic ---
            if (typeof window.zonoConfig !== 'undefined') {
                const config = window.zonoConfig;
                console.log("Configuración cargada:", config); // Log para ver si config se carga

                const headerWhatsappLink = document.getElementById('header-whatsapp-link');
                if (headerWhatsappLink) headerWhatsappLink.href = config.getWhatsAppUrl(config.whatsappGeneralQueryText);

                const whatsappFloatButton = document.getElementById('whatsapp-float-button');
                if (whatsappFloatButton) whatsappFloatButton.href = config.getWhatsAppUrl(config.whatsappCatalogHelpText || config.whatsappHelpText);

                const footerEmailLink = document.getElementById('footer-email-link');
                const footerEmailAddressSpan = document.getElementById('footer-email-address');
                if (footerEmailLink && footerEmailAddressSpan) { footerEmailLink.href = `mailto:${config.email}`; footerEmailAddressSpan.textContent = config.email; }

                const footerFacebookLink = document.getElementById('footer-facebook-link');
                if (footerFacebookLink) footerFacebookLink.href = config.facebookUrl;

                const footerInstagramLink = document.getElementById('footer-instagram-link');
                if (footerInstagramLink) footerInstagramLink.href = config.instagramUrl;

                // --- Cargar Productos desde Google Sheet ---
                const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSvvFPA-f9xiHY0ktx6vvIz9b_wcnCiVWugW1Pv92i7HHUJQSD40vhS_0zhdFI7AhgJTqZ-8G1BdY2q/pub?gid=0&single=true&output=csv"; // Reemplaza con tu URL real
                console.log("Intentando cargar desde:", sheetUrl);

                const productContainers = document.querySelectorAll('.product-grid-container');

                if (sheetUrl === "TU_URL_CSV_PUBLICADA_AQUI") { // Mantenemos la verificación por si acaso
                     console.warn("URL de Google Sheet no configurada.");
                     productContainers.forEach(container => { container.innerHTML = '<p class="loading-message col-span-full text-red-500">Error: URL de Google Sheet no configurada.</p>'; });
                } else {
                    fetch(sheetUrl)
                        .then(response => {
                            console.log("Respuesta Fetch:", response.status, response.statusText); // Log del estado de la respuesta
                            if (!response.ok) {
                                throw new Error(`Error HTTP ${response.status}: ${response.statusText}`);
                            }
                            return response.text();
                        })
                        .then(csvText => {
                            console.log("CSV recibido (primeros 500 chars):", csvText.substring(0, 500)); // Log para ver el CSV
                            productContainers.forEach(container => container.innerHTML = ''); // Limpiar

                            const rows = csvText.trim().split('\n');
                            if (rows.length < 2) {
                                console.warn("CSV vacío o solo con encabezados.");
                                productContainers.forEach(container => { container.innerHTML = '<p class="loading-message col-span-full">No hay productos para mostrar (CSV vacío).</p>'; });
                                return;
                            }

                            const headers = rows[0].split(',').map(h => h.trim());
                            console.log("Encabezados encontrados:", headers); // Log de encabezados

                            const idxImagen = headers.indexOf("Nombre Imagen");
                            const idxNombre = headers.indexOf("Nombre Producto");
                            const idxDesc = headers.indexOf("Descripción");
                            const idxCategoria = headers.indexOf("CategoriaID");

                            if (idxImagen === -1 || idxNombre === -1 || idxDesc === -1 || idxCategoria === -1) {
                                console.error("Error: Faltan columnas requeridas. Se encontraron:", headers);
                                productContainers.forEach(container => { container.innerHTML = '<p class="loading-message col-span-full text-red-500">Error: Faltan columnas en Google Sheet.</p>'; });
                                return;
                            }
                            console.log("Índices columnas:", { idxImagen, idxNombre, idxDesc, idxCategoria }); // Log de índices

                            let productsLoaded = false; // Flag para saber si se cargó al menos un producto
                            for (let i = 1; i < rows.length; i++) {
                                // Split más robusto considerando posibles comas dentro de campos entre comillas
                                const values = rows[i].match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g)?.map(v => v.replace(/^"|"$/g, '').trim()) || [];

                                if (values.length < headers.length) {
                                    console.warn(`Fila ${i+1} ignorada: número incorrecto de columnas (${values.length} vs ${headers.length}). Contenido: ${rows[i]}`);
                                    continue; // Saltar fila si no tiene suficientes columnas
                                }

                                const nombreImagen = values[idxImagen];
                                const nombreProducto = values[idxNombre];
                                const descripcion = values[idxDesc];
                                const categoriaId = values[idxCategoria];

                                console.log(`Procesando fila ${i+1}: CatID=${categoriaId}, Nombre=${nombreProducto}`); // Log por cada fila

                                if (!categoriaId || !nombreProducto || !nombreImagen) {
                                     console.warn(`Fila ${i+1} ignorada: Faltan datos esenciales (Categoría, Nombre o Imagen).`);
                                     continue;
                                }

                                const targetContainer = document.querySelector(`#${categoriaId} .product-grid-container`);

                                if (targetContainer) {
                                    productsLoaded = true; // Marcamos que al menos un producto se intentó cargar
                                    const productCard = document.createElement('div');
                                    productCard.className = 'bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-shadow duration-300 group flex flex-col';
                                    const whatsappUrl = config.getWhatsAppUrl(config.whatsappProductQueryBaseText + nombreProducto);

                                    productCard.innerHTML = `
                                        <div class="product-image-container">
                                            <img src="images/${nombreImagen}"
                                                 onerror="this.onerror=null; this.src='https://placehold.co/600x600/eeeeee/aaaaaa?text=Imagen%20(${nombreImagen})%20no%20encontrada';"
                                                 alt="${nombreProducto}"
                                                 class="product-image">
                                        </div>
                                        <div class="p-4 flex flex-col flex-grow">
                                            <h4 class="text-lg font-semibold mb-1 text-blue-700 dark:text-blue-400 truncate" title="${nombreProducto}">
                                                ${nombreProducto}
                                            </h4>
                                            <p class="text-sm text-gray-600 dark:text-gray-300 mb-3 flex-grow">
                                                ${descripcion || 'Descripción no disponible.'}
                                            </p>
                                            <a href="${whatsappUrl}" target="_blank" class="whatsapp-product-link mt-auto text-sm bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-md font-medium flex items-center justify-center space-x-1 transition duration-300 w-full" data-producto="${nombreProducto}">
                                                <i class="fab fa-whatsapp"></i>
                                                <span>Consultar Precio</span>
                                            </a>
                                        </div>
                                    `;
                                    const loadingMsg = targetContainer.querySelector('.loading-message');
                                    if (loadingMsg) loadingMsg.remove();
                                    targetContainer.appendChild(productCard);
                                } else {
                                    console.warn(`Contenedor no encontrado para categoría ID: ${categoriaId}`);
                                }
                            }
                            // Mensaje final si no se cargó NADA
                            if (!productsLoaded) {
                                 console.warn("No se cargó ningún producto válido.");
                                 productContainers.forEach(container => {
                                     if (container.children.length === 0) { // Solo si está realmente vacío
                                        container.innerHTML = '<p class="loading-message col-span-full">No se encontraron productos válidos para cargar.</p>';
                                     }
                                 });
                            }
                             // Mensaje si alguna categoría específica quedó vacía
                             productContainers.forEach(container => {
                                if (container.children.length === 0) {
                                    container.innerHTML = '<p class="loading-message col-span-full">No hay productos en esta categoría.</p>';
                                }
                            });

                        })
                        .catch(error => {
                            console.error('Error en Fetch o procesamiento CSV:', error);
                             productContainers.forEach(container => {
                                container.innerHTML = `<p class="loading-message col-span-full text-red-500">Error al cargar productos: ${error.message}</p>`;
                            });
                        });
                }


            } else { console.error("Error: config.js no se cargó correctamente o window.zonoConfig no está definido."); }
            // --- End Config Data Logic ---

            document.getElementById('year').textContent = new Date().getFullYear();
            const mobileMenuButton = document.querySelector('header button.md\\:hidden'); const mobileMenu = document.querySelector('header div.hidden.md\\:flex'); if (mobileMenuButton && mobileMenu) { mobileMenuButton.addEventListener('click', () => { mobileMenu.classList.toggle('hidden'); }); }

            // Script para resaltar enlace activo en sidebar al hacer scroll
            const sections = document.querySelectorAll('main section[id^="cat-"]');
            const sidebarLinks = document.querySelectorAll('.sidebar-link');
            if (sections.length > 0 && sidebarLinks.length > 0) {
                const observerOptions = { root: null, rootMargin: '-20% 0px -70% 0px', threshold: 0 };
                const observer = new IntersectionObserver(entries => {
                    entries.forEach(entry => {
                        const id = entry.target.getAttribute('id');
                        const correspondingLink = document.querySelector(`.sidebar-link[href="#${id}"]`);
                        if (entry.isIntersecting) {
                            sidebarLinks.forEach(link => link.classList.remove('sidebar-link-active'));
                            if (correspondingLink) { correspondingLink.classList.add('sidebar-link-active'); }
                        }
                    });
                }, observerOptions);
                sections.forEach(section => { observer.observe(section); });
            }
        });
    </script>

</body>
</html>
